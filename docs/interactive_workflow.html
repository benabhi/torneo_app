<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workflow Interactivo del Gestor de Torneos</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg: #f8f9fa;
            --color-surface: #ffffff;
            --color-primary: #0d6efd;
            --color-accent: #6c757d;
            --color-text: #212529;
            --color-border: #dee2e6;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.07);
            --shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
            --transition-speed: 0.4s;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            margin: 0;
            padding: 40px 20px;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2.8em;
            color: var(--color-text);
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            color: var(--color-accent);
            max-width: 700px;
            margin: 0 auto;
        }

        .view-toggle-container {
            text-align: center;
            margin: 30px 0;
        }

        .toggle-btn {
            background-color: var(--color-surface);
            color: var(--color-primary);
            border: 2px solid var(--color-border);
            padding: 10px 20px;
            font-size: 0.9em;
            font-weight: bold;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .toggle-btn:hover {
            border-color: var(--color-primary);
            box-shadow: var(--shadow);
        }

        .main-container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--color-surface);
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: max-width var(--transition-speed) ease;
        }

        .progress-bar-container {
            width: 100%;
            background-color: #e9ecef;
            border-radius: 20px;
            margin-bottom: 40px;
            overflow: hidden;
            transition: opacity 0.2s, height 0.2s, margin 0.2s;
        }

        .progress-bar {
            height: 10px;
            width: 0%;
            background-color: var(--color-primary);
            border-radius: 20px;
            transition: width var(--transition-speed) ease-in-out;
        }

        .workflow-container {
            display: grid;
        }

        .workflow-phase {
            grid-area: 1 / 1;
            width: 320px;
            margin: 0 auto;
            transition: opacity var(--transition-speed) ease-in-out, transform var(--transition-speed) ease-in-out;
            opacity: 0;
            transform: translateX(30px);
            visibility: hidden;
            display: none;
        }

        .workflow-phase.active {
            opacity: 1;
            transform: translateX(0);
            visibility: visible;
            display: block;
        }

        .workflow-phase.exiting {
            transform: translateX(-30px);
        }

        .workflow-phase h2 {
            text-align: center;
            margin-top: 0;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--color-primary);
            color: var(--color-primary);
            font-size: 1.4em;
        }

        .steps-wrapper {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .workflow-step {
            background-color: #fdfdff;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: 15px;
            text-align: center;
            position: relative;
            margin-bottom: 45px;
            font-size: 0.95em;
            width: 90%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
            cursor: pointer;
        }

        .workflow-step:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .steps-wrapper>.workflow-step:not(:last-child)::after {
            content: '';
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 20px;
            background-color: var(--color-accent);
        }

        .steps-wrapper>.workflow-step:not(:last-child)::before {
            content: '▼';
            position: absolute;
            bottom: -45px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--color-accent);
            font-size: 1.2em;
        }

        .step-start {
            background-color: #e7f5ff;
            border-color: #90caff;
        }

        .step-end {
            background-color: #d1e7dd;
            border-color: #a3cfbb;
            font-weight: bold;
        }

        .step-decision {
            background-color: #fff9db;
            border-color: #ffec85;
            border-radius: 30px;
            font-style: italic;
        }

        .step-io {
            border-left: 4px solid var(--color-primary);
        }

        .branch-info {
            font-size: 0.8em;
            color: var(--color-accent);
            margin-top: 5px;
            font-weight: bold;
        }

        .secondary-actions {
            margin-top: 20px;
            width: 100%;
        }

        .secondary-actions h3 {
            font-size: 0.9em;
            color: var(--color-accent);
            text-align: center;
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .secondary-actions .workflow-step {
            border-style: dashed;
            background-color: #fafafa;
            margin-bottom: 20px;
        }


        .workflow-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            border-top: 1px solid var(--color-border);
            padding-top: 20px;
            transition: opacity 0.2s, height 0.2s, margin 0.2s;
        }

        .nav-btn {
            background-color: var(--color-primary);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1em;
            font-weight: bold;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color var(--transition-speed) ease, transform var(--transition-speed) ease;
        }

        .nav-btn:hover {
            background-color: #0b5ed7;
            transform: translateY(-2px);
        }

        .nav-btn:disabled {
            background-color: var(--color-accent);
            cursor: not-allowed;
            transform: none;
        }

        .phase-connector {
            display: none;
            align-items: center;
            justify-content: center;
            color: var(--color-accent);
        }

        body.full-view-active .main-container {
            max-width: 1600px;
        }

        body.full-view-active .progress-bar-container,
        body.full-view-active .workflow-nav {
            opacity: 0;
            visibility: hidden;
            height: 0;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        body.full-view-active .workflow-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }

        body.full-view-active .workflow-phase {
            position: static;
            display: block;
            opacity: 1;
            visibility: visible;
            transform: none;
        }

        body.full-view-active .phase-connector {
            display: flex;
        }

        .side-panel {
            position: fixed;
            top: 0;
            right: -480px;
            width: 420px;
            height: 100%;
            background: var(--color-surface);
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            transition: right var(--transition-speed) ease;
            display: flex;
            flex-direction: column;
        }

        .side-panel.open {
            right: 0;
        }

        .side-panel-header {
            padding: 25px 30px;
            border-bottom: 1px solid var(--color-border);
            flex-shrink: 0;
        }

        .side-panel-header h3 {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            font-size: 1.5em;
            color: var(--color-primary);
        }

        .side-panel-content {
            padding: 30px;
            overflow-y: auto;
            flex-grow: 1;
        }

        .side-panel-content h4 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.1em;
            margin-top: 25px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 10px;
            color: var(--color-text);
        }

        .side-panel-content p {
            font-size: 0.95em;
            line-height: 1.7;
            margin: 0 0 1em 0;
        }

        .side-panel-content .file-info {
            font-weight: 400;
            font-size: 0.9em;
            color: var(--color-accent);
        }

        .side-panel pre {
            background: #2d3748;
            padding: 20px;
            border-radius: var(--border-radius);
            font-family: 'Fira Code', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 1px solid #4A5568;
            margin-top: 0;
        }

        .side-panel code {
            color: #e2e8f0;
            font-size: 14px;
            line-height: 1.6;
        }

        .code-keyword {
            color: #82aaff;
            font-weight: 500;
        }

        .code-function {
            color: #c792ea;
        }

        .code-string {
            color: #c3e88d;
        }

        .code-comment {
            color: #637777;
            font-style: italic;
        }

        .code-class {
            color: #ffcb6b;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2.5em;
            color: var(--color-accent);
            cursor: pointer;
            line-height: 1;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-speed) ease;
        }

        .overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        @media (max-width: 1700px) {
            body.full-view-active .workflow-container {
                flex-direction: column;
                align-items: center;
            }

            body.full-view-active .phase-connector {
                transform: rotate(90deg);
                margin: 20px 0;
            }
        }
    </style>
</head>

<body>

    <div class="header">
        <h1>Workflow Interactivo del Gestor de Torneos</h1>
        <p>Navega a través del ciclo de vida de la aplicación. Haz clic en un paso para ver los detalles técnicos.</p>
    </div>

    <div class="view-toggle-container">
        <button id="toggleViewBtn" class="toggle-btn">Ver Diagrama Completo</button>
    </div>

    <div class="main-container">
        <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar"></div>
        </div>
        <div id="workflowContainer" class="workflow-container">
            <!-- Fases generadas por JS -->
        </div>
        <div class="workflow-nav">
            <button id="prevBtn" class="nav-btn">Anterior</button>
            <button id="nextBtn" class="nav-btn">Siguiente</button>
        </div>
    </div>

    <div id="sidePanel" class="side-panel">
        <div class="side-panel-header">
            <h3 id="panelTitle"></h3>
            <button id="closePanelBtn" class="close-btn">&times;</button>
        </div>
        <div class="side-panel-content">
            <h4>Descripción</h4>
            <p id="panelDescription"></p>
            <div id="panelSubprocesses"></div>
            <h4>Fragmento de Código <span id="panelFileInfo" class="file-info"></span></h4>
            <pre><code id="panelCode"></code></pre>
        </div>
    </div>
    <div id="overlay" class="overlay"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const phasesData = [
                {
                    title: "Arranque y Configuración",
                    steps: [
                        { id: "s1-1", title: "▶ Iniciar main.py", type: "start", desc: "Este es el punto de entrada de la aplicación. Al ejecutar el archivo, el intérprete de Python busca el bloque `if __name__ == '__main__':` y ejecuta la función `main()` que contiene.", file: "main.py", lines: "líneas 87-88", code: `<span class="code-keyword">if</span> __name__ == <span class="code-string">"__main__"</span>:\n    main()` },
                        { id: "s1-2", title: "Se crea la ventana principal", desc: "Dentro de `main()`, se crea una instancia de la clase `App` del módulo `gui`. Esta clase hereda de `tkinter.Tk`, por lo que esta instancia es la ventana raíz de toda la interfaz gráfica.", file: "main.py", lines: "línea 38", code: `<span class="code-keyword">def</span> <span class="code-function">main</span>():\n    <span class="code-comment">"""Función principal que crea y lanza la aplicación."""</span>\n    app = gui.<span class="code-class">App</span>()` },
                        { id: "s1-3", title: "Se construyen las 3 pestañas", desc: "El constructor de la clase `App` (`__init__`) se encarga de crear todos los widgets. Entre ellos, un `ttk.Notebook` al que se le añaden tres frames, cada uno representando una fase del torneo.", file: "lib/gui.py", lines: "líneas 122-131", code: `<span class="code-keyword">self</span>.notebook = ttk.Notebook(<span class="code-keyword">self</span>)\n<span class="code-keyword">self</span>.notebook.pack(pady=10, padx=10, expand=<span class="code-class">True</span>, fill=<span class="code-string">"both"</span>)\n\n<span class="code-keyword">self</span>.frame_equipos = ttk.Frame(<span class="code-keyword">self</span>.notebook)\n<span class="code-keyword">self</span>.notebook.add(<span class="code-keyword">self</span>.frame_equipos, text=<span class="code-string">'1. Gestionar Equipos'</span>)` },
                        { id: "s1-4", title: "Se cargan datos de la BD", desc: "Al final del constructor, se llama a `actualizar_todas_las_vistas()`. Este método crucial consulta la base de datos para obtener el estado actual (equipos, partidos, etc.) y configura la UI en consecuencia (habilitando/deshabilitando widgets, llenando tablas).", sub: "Llama a: `_update_ui_state()`, `actualizar_lista_equipos()`", file: "lib/gui.py", lines: "línea 140", code: `<span class="code-keyword">def</span> <span class="code-function">__init__</span>(<span class="code-keyword">self</span>):\n    <span class="code-comment"># ...</span>\n    <span class="code-keyword">self</span>.actualizar_todas_las_vistas()` },
                        { id: "s1-5", title: "La aplicación espera interacción", desc: "La llamada a `app.mainloop()` es bloqueante. Pone a Tkinter en un bucle infinito que escucha eventos del sistema operativo (clics, teclado, etc.) y actualiza la UI. El programa permanecerá en esta línea hasta que se cierre la ventana.", file: "main.py", lines: "línea 80", code: `    <span class="code-comment"># 3. Iniciar el bucle de eventos principal de la aplicación.</span>\n    app.mainloop()` }
                    ]
                },
                {
                    title: "Fase 1: Gestión de Equipos",
                    steps: [
                        { id: "s2-1", title: "El usuario añade equipos", desc: "El usuario rellena los campos de texto y el combobox de zona. Al presionar 'Agregar', se invoca el método `agregar_equipo` que valida los datos y llama a la base de datos.", sub: "Llama a: `database.db.agregar_equipo()`", file: "lib/gui.py", lines: "líneas 480-499", code: `<span class="code-keyword">def</span> <span class="code-function">agregar_equipo</span>(<span class="code-keyword">self</span>):\n    nombre = <span class="code-keyword">self</span>.entry_nombre.get().strip()\n    zona = <span class="code-keyword">self</span>.combo_zona.get()\n    \n    <span class="code-keyword">if</span> nombre <span class="code-keyword">and</span> zona:\n        exito = database.db.agregar_equipo(nombre, zona)\n        <span class="code-keyword">if</span> exito:\n            <span class="code-keyword">self</span>.actualizar_lista_equipos()\n            <span class="code-comment"># ...</span>\n        <span class="code-keyword">else</span>:\n            messagebox.showerror(<span class="code-string">"Error de Duplicado"</span>, ...)` },
                        { id: "s2-2", title: "¿Todas las zonas están llenas?", desc: "El método `_update_ui_state` se ejecuta tras cada cambio. Compara el número de equipos en cada zona con el valor `MAX_EQUIPOS_POR_ZONA` de `config.py`. Si todas las zonas están llenas, la condición se cumple.", file: "lib/gui.py", lines: "líneas 196-197", code: `todos_los_grupos_llenos = <span class="code-function">all</span>(\n    count == config.MAX_EQUIPOS_POR_ZONA \n    <span class="code-keyword">for</span> count <span class="code-keyword">in</span> equipos_por_zona.values()\n)` },
                        { id: "s2-3", title: "Aparece el botón 'Confirmar'", desc: "Si la condición anterior es verdadera, el método `_update_ui_state` hace visible el botón 'Confirmar Equipos' usando `.grid()`. En caso contrario, lo oculta con `.grid_remove()`.", file: "lib/gui.py", lines: "líneas 231-234", code: `<span class="code-keyword">if</span> todos_los_grupos_llenos:\n    <span class="code-keyword">self</span>.btn_confirmar_equipos.grid()\n<span class="code-keyword">else</span>:\n    <span class="code-keyword">self</span>.btn_confirmar_equipos.grid_remove()` },
                        { id: "s2-4", title: "Se bloquea la lista en BD", desc: "Al hacer clic en 'Confirmar', se guarda una llave ('equipos_bloqueados') con valor '1' en la tabla de configuración de la base de datos. Este 'flag' será leído en futuras ejecuciones para mantener el estado.", file: "lib/gui.py", lines: "líneas 327-328", code: `<span class="code-keyword">if</span> messagebox.askyesno(<span class="code-string">"Confirmar y Bloquear"</span>, ...):\n    database.db.establecer_config(<span class="code-string">'equipos_bloqueados'</span>, <span class="code-string">'1'</span>)` },
                        { id: "s2-5", title: "Fase de Grupos habilitada", desc: "Con el flag 'equipos_bloqueados' activado, `_update_ui_state` ahora habilitará la segunda pestaña del Notebook, permitiendo al usuario avanzar.", file: "lib/gui.py", lines: "línea 236", code: `<span class="code-comment"># Habilita o deshabilita la pestaña de Fase de Grupos.</span>\n<span class="code-keyword">self</span>.notebook.tab(<span class="code-class">1</span>, state=<span class="code-string">'normal'</span> <span class="code-keyword">if</span> equipos_estan_bloqueados <span class="code-keyword">else</span> <span class="code-string">'disabled'</span>)` }
                    ]
                },
                {
                    title: "Fase 2: Fase de Grupos",
                    steps: [
                        { id: "s3-1", title: "Usuario registra resultados", desc: "En la pestaña 2, el usuario selecciona un partido pendiente y rellena los goles. El botón 'Guardar' llama a `registrar_partido_grupo`, que inserta un nuevo registro en la tabla de partidos de la BD.", file: "lib/gui.py", lines: "líneas 637-658", code: `<span class="code-keyword">def</span> <span class="code-function">registrar_partido_grupo</span>(<span class="code-keyword">self</span>):\n    <span class="code-comment"># ... validaciones ...</span>\n    goles_local, goles_visitante = <span class="code-function">int</span>(goles_local_str), <span class="code-function">int</span>(goles_visitante_str)\n    <span class="code-comment"># ...</span>\n    database.db.registrar_partido(<span class="code-string">"Grupo"</span>, local_id, ...)` },
                        { id: "s3-2", title: "¿Todos los partidos jugados?", desc: "De nuevo, `_update_ui_state` es el responsable. Itera por cada zona y llama a `logic.generar_fixture_zona`. Si esta función devuelve una lista vacía para todas las zonas, significa que no quedan partidos por jugar.", file: "lib/gui.py", lines: "líneas 240-244", code: `todos_jugados = <span class="code-class">True</span>\n<span class="code-keyword">for</span> zona <span class="code-keyword">in</span> config.ZONAS_DEL_TORNEO:\n    <span class="code-keyword">if</span> logic.generar_fixture_zona(zona):\n        todos_jugados = <span class="code-class">False</span>\n        <span class="code-keyword">break</span>` },
                        { id: "s3-3", title: "Aparece botón 'Confirmar'", desc: "Si `todos_jugados` es `True`, el botón para confirmar y bloquear la fase de grupos se hace visible.", file: "lib/gui.py", lines: "líneas 260-262", code: `<span class="code-keyword">if</span> todos_jugados <span class="code-keyword">and</span> <span class="code-function">len</span>(database.db.obtener_equipos()) > <span class="code-class">0</span>:\n    <span class="code-keyword">self</span>.btn_confirmar_grupos.grid()\n    <span class="code-keyword">self</span>.btn_reiniciar_carga.grid()` },
                        { id: "s3-4", title: "Se bloquea la fase en BD", desc: "Similar a la fase anterior, se establece el flag 'fase_grupos_bloqueada' en la base de datos.", file: "lib/gui.py", lines: "líneas 432-433", code: `<span class="code-keyword">if</span> messagebox.askyesno(<span class="code-string">"Confirmar y Bloquear"</span>, ...):\n    database.db.establecer_config(<span class="code-string">'fase_grupos_bloqueada'</span>, <span class="code-string">'1'</span>)` },
                        { id: "s3-5", title: "Fases Eliminatorias habilitada", desc: "Este nuevo flag permite que `_update_ui_state` habilite la tercera y última pestaña del torneo.", file: "lib/gui.py", lines: "línea 267", code: `<span class="code-comment"># Habilita o deshabilita la pestaña de Fases Eliminatorias.</span>\n<span class="code-keyword">self</span>.notebook.tab(<span class="code-class">2</span>, state=<span class="code-string">'normal'</span> <span class="code-keyword">if</span> grupos_estan_bloqueados <span class="code-keyword">else</span> <span class="code-string">'disabled'</span>)` }
                    ]
                },
                {
                    title: "Fase 3: Eliminatorias (Ciclo)",
                    steps: [
                        { id: "s4-1", title: "Generar cruces de la fase", desc: "Al cambiar a la pestaña 3, `_actualizar_vista_eliminatorias` se ejecuta. Llama a la capa de lógica (`logic.py`) para generar los enfrentamientos, ya sea los iniciales (`generar_enfrentamientos_iniciales`) o los de rondas subsecuentes (`generar_enfrentamientos`).", sub: "Llama a `logic.py`", file: "lib/gui.py", lines: "líneas 781-787", code: `<span class="code-keyword">def</span> <span class="code-function">_generar_y_mostrar_fase</span>(<span class="code-keyword">self</span>, fase, fase_anterior):\n    <span class="code-keyword">if</span> fase_anterior == <span class="code-string">'Grupo'</span>:\n        enfrentamientos = logic.generar_enfrentamientos_iniciales()\n    <span class="code-keyword">else</span>:\n        enfrentamientos = logic.generar_enfrentamientos(fase_anterior)` },
                        { id: "s4-2", title: "Usuario ingresa resultados", desc: "La UI muestra los cruces con campos para los goles. El usuario rellena todos los resultados de la ronda y presiona 'Registrar Todos los Partidos'.", file: "lib/gui.py", lines: "líneas 882-915", code: `<span class="code-keyword">def</span> <span class="code-function">registrar_fase_completa</span>(<span class="code-keyword">self</span>, fase):\n    partidos_info = <span class="code-keyword">self</span>.entry_widgets_por_fase.get(fase, [])\n    <span class="code-comment"># ... Itera y valida que no haya empates ...</span>\n    <span class="code-keyword">for</span> fase_db, local_db, ... <span class="code-keyword">in</span> resultados_validados:\n        database.db.registrar_partido(...)` },
                        { id: "s4-3", title: "¿Era la Final?", desc: "Después de registrar una fase, se vuelve a llamar a `_actualizar_vista_eliminatorias`. El código comprueba si la fase recién completada fue la 'Final'. Si no lo fue, la lógica entra en el ciclo de generar la siguiente ronda. Si lo fue, el ciclo termina.", file: "lib/gui.py", lines: "líneas 748-750", code: `partidos_final = database.db.obtener_partidos_fase(<span class="code-string">"Final"</span>)\n<span class="code-keyword">if</span> partidos_final <span class="code-keyword">and</span> <span class="code-function">len</span>(partidos_final) >= <span class="code-class">1</span>:\n     <span class="code-keyword">self</span>._mostrar_campeon()` },
                        { id: "s4-4", title: "Se obtiene el ganador", desc: "Si la condición anterior se cumple, se llama al método `_mostrar_campeon`, que a su vez pide a la lógica el nombre del ganador de la final.", file: "lib/gui.py", lines: "líneas 865-866", code: `<span class="code-keyword">def</span> <span class="code-function">_mostrar_campeon</span>(<span class="code-keyword">self</span>):\n    ganador_final = logic.obtener_ganadores(<span class="code-string">"Final"</span>)` },
                        { id: "s4-5", title: "🏆 Se muestra el Campeón 🏁", desc: "Finalmente, la UI se actualiza para mostrar una sección especial con el nombre del equipo campeón, concluyendo el torneo.", file: "lib/gui.py", lines: "líneas 872-874", code: `lbl_campeon = ttk.Label(..., text=<span class="code-function">f</span><span class="code-string">' {ganador_final[0]}'</span>, ...)\nlbl_campeon.pack(pady=<span class="code-class">15</span>)` }
                    ]
                }
            ];

            const body = document.body;
            const toggleBtn = document.getElementById('toggleViewBtn');
            const workflowContainer = document.getElementById('workflowContainer');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const progressBar = document.getElementById('progressBar');
            const sidePanel = document.getElementById('sidePanel');
            const closePanelBtn = document.getElementById('closePanelBtn');
            const overlay = document.getElementById('overlay');

            let currentPhaseIndex = 0;

            function buildHTML() {
                workflowContainer.innerHTML = '';

                phasesData.forEach((phaseData, index) => {
                    const phaseDiv = document.createElement('div');
                    phaseDiv.className = 'workflow-phase';
                    phaseDiv.dataset.phase = index;

                    let stepsHTML = phaseData.steps.map(step => `
                        <div class="workflow-step ${step.type ? 'step-' + step.type : ''}" data-id="${step.id}">
                            ${step.title}
                        </div>
                    `).join('');

                    let secondaryStepsHTML = '';
                    if (phaseData.secondary_steps) {
                        secondaryStepsHTML = '<div class="secondary-actions"><h3>Acciones Secundarias</h3>' +
                            phaseData.secondary_steps.map(step => `
                        <div class="workflow-step" data-id="${step.id}">
                            ${step.title}
                        </div>`).join('') + '</div>';
                    }

                    phaseDiv.innerHTML = `<h2>${phaseData.title}</h2><div class="steps-wrapper">${stepsHTML}</div>${secondaryStepsHTML}`;
                    workflowContainer.appendChild(phaseDiv);

                    if (index < phasesData.length - 1) {
                        const connector = document.createElement('div');
                        connector.className = 'phase-connector';
                        connector.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>';
                        workflowContainer.appendChild(connector);
                    }
                });
            }

            buildHTML();

            const phases = document.querySelectorAll('.workflow-phase');

            function updateWorkflow() {
                phases.forEach((phase, index) => {
                    phase.classList.toggle('active', index === currentPhaseIndex && !body.classList.contains('full-view-active'));
                });
                prevBtn.disabled = currentPhaseIndex === 0;
                nextBtn.disabled = currentPhaseIndex === phases.length - 1;
                const progressPercentage = (currentPhaseIndex / (phases.length - 1)) * 100;
                progressBar.style.width = `${progressPercentage}%`;
            }

            function switchPhase(newIndex) {
                if (newIndex < 0 || newIndex >= phases.length) return;
                const oldPhase = phases[currentPhaseIndex];
                if (oldPhase) {
                    oldPhase.classList.add('exiting');
                    oldPhase.classList.remove('active');
                }
                currentPhaseIndex = newIndex;
                setTimeout(() => {
                    if (oldPhase) oldPhase.classList.remove('exiting');
                    updateWorkflow();
                }, 50);
            }

            function openPanel(stepId) {
                const allSteps = phasesData.flatMap(p => [...p.steps, ...(p.secondary_steps || [])]);
                const data = allSteps.find(s => s.id === stepId);
                if (!data) return;

                document.getElementById('panelTitle').innerHTML = data.title;
                document.getElementById('panelDescription').textContent = data.desc;

                const subprocessesContainer = document.getElementById('panelSubprocesses');
                if (data.sub) {
                    subprocessesContainer.innerHTML = `<h4>Subprocesos Involucrados</h4><p>${data.sub}</p>`;
                } else {
                    subprocessesContainer.innerHTML = '';
                }

                document.getElementById('panelFileInfo').textContent = `(${data.file}, ${data.lines})`;
                document.getElementById('panelCode').innerHTML = data.code;

                sidePanel.classList.add('open');
                overlay.classList.add('visible');
            }

            function closePanel() {
                sidePanel.classList.remove('open');
                overlay.classList.remove('visible');
            }

            nextBtn.addEventListener('click', () => switchPhase(currentPhaseIndex + 1));
            prevBtn.addEventListener('click', () => switchPhase(currentPhaseIndex - 1));

            toggleBtn.addEventListener('click', () => {
                body.classList.toggle('full-view-active');
                toggleBtn.textContent = body.classList.contains('full-view-active') ? 'Ver Modo Interactivo' : 'Ver Diagrama Completo';
            });

            workflowContainer.addEventListener('click', (e) => {
                const step = e.target.closest('.workflow-step');
                if (step && step.dataset.id) {
                    openPanel(step.dataset.id);
                }
            });

            closePanelBtn.addEventListener('click', closePanel);
            overlay.addEventListener('click', closePanel);

            updateWorkflow();
        });
    </script>

</body>

</html>